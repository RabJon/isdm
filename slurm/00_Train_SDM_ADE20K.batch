#!/bin/bash
#SBATCH --job-name=SDM-ADE20K-Train
#SBATCH --output=SDM-ADE20K-Train-%j.out
#SBATCH --error=SDM-ADE20K-Train-%j.err
#SBATCH --partition gpu
#SBATCH --ntasks-per-node=2 
#SBATCH --nodes=1
#SBATCH --gres=gpu:1

source /opt/packages/anaconda3/etc/profile.d/conda.sh

conda activate sdm

echo "sdm activated! Executing SDM-ADE20K-Train..."

# Training
echo "Starting training ..."
export OPENAI_LOGDIR='OUTPUT/ADE20K-SDM-256CH'
python image_train.py --data_dir ./data/ade20k --dataset_mode ade20k --lr 1e-4 --batch_size 4 --attention_resolutions 32,16,8 --diffusion_steps 1000 --image_size 256 --learn_sigma True \
	     --noise_schedule linear --num_channels 256 --num_head_channels 64 --num_res_blocks 2 --resblock_updown True --use_fp16 True --use_scale_shift_norm True --use_checkpoint True --num_classes 151 \
	     --class_cond True --no_instance True
#python tmp_pytorch_cuda_test.py


echo "Execution of SDM-ADE20K-Train terminated!"